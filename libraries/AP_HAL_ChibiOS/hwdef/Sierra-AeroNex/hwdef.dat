# hw definition file for processing by chibios_pins.py

# Sierra-AeroNex

# MCU class and specific type
MCU STM32F4xx STM32F405xx

# board ID for firmware load
APJ_BOARD_ID 1095

# crystal frequency
OSCILLATOR_HZ 16000000

# USB
PA11 USB_FS_DM OTG1
PA12 USB_FS_DP OTG1
PA9 VBUS INPUT OPENDRAIN

# Add CS pins
PC0 DPS310_CS CS
PC4 ICM42688_CS CS
PC14 BMI088_G_CS CS
PC15 BMI088_A_CS CS

# SPI1 for ICM42688
PA5 SPI1_SCK SPI1
PA6 SPI1_MISO SPI1
PA7 SPI1_MOSI SPI1

# SPI3 for BMI088 and DPS310 
PB3 SPI3_SCK SPI3
PB4 SPI3_MISO SPI3
PB5 SPI3_MOSI SPI3

# Sensors
SPIDEV bmi088_g SPI3 DEVID1  BMI088_G_CS  MODE3 5*MHZ 5*MHZ
SPIDEV bmi088_a SPI3 DEVID2  BMI088_A_CS  MODE3 5*MHZ 5*MHZ
SPIDEV icm42688 SPI1 DEVID1  ICM42688_CS  MODE3  2*MHZ  8*MHZ
SPIDEV DPS310   SPI3 DEVID3  DPS310_CS    MODE3 5*MHZ 5*MHZ

IMU Invensensev3 SPI:icm42688 ROTATION_ROLL_180
IMU BMI088 SPI:bmi088_a SPI:bmi088_g ROTATION_ROLL_180
BARO DPS310 SPI:DPS310

# Board voltage ADC
define HAL_USE_ADC TRUE
PC1 VDD_5V_SENS ADC1 SCALE(2)

# enable CAN support
PB8 CAN1_RX CAN1
PB9 CAN1_TX CAN1
PC13 GPIO_CAN1_SILENT OUTPUT PUSHPULL SPEED_LOW LOW

# SD Card pins
PC8 SDIO_D0 SDIO
PC9 SDIO_D1 SDIO
PC10 SDIO_D2 SDIO
PC11 SDIO_D3 SDIO
PC12 SDIO_CK SDIO
PD2 SDIO_CMD SDIO

define STM32_ST_USE_TIMER 5
define CH_CFG_ST_RESOLUTION 32
FLASH_RESERVE_START_KB 48
FLASH_SIZE_KB 1024
define HAL_STORAGE_SIZE 15360
STORAGE_FLASH_PAGE 1

# order of UARTs (and USB)
SERIAL_ORDER OTG1 USART1 USART2 USART6

# LEDs
PB12 LED_STATUS OUTPUT
define HAL_LED_ON 0

# only one I2C bus
I2C_ORDER I2C2
PB10 I2C2_SCL I2C2
PB11 I2C2_SDA I2C2

# USART1 (RCIN with inverter)
PA10 TIM1_CH3 TIM1 RCININT PULLDOWN LOW

# alternative with PA10 as USART1_RX
PB6 USART1_TX USART1 NODMA
PA10 USART1_RX USART1 NODMA ALT(1)

# telem1 on UART2
PA2 USART2_TX USART2
PA3 USART2_RX USART2
PA1 USART2_RTS USART2
PA0 USART2_CTS USART2

# UART6 for GPS
PC6 USART6_TX USART6
PC7 USART6_RX USART6

# PWM channels
PB7  TIM4_CH2  TIM4  PWM(1) GPIO(50)
PB0  TIM3_CH3  TIM3  PWM(2) GPIO(51)
PB1  TIM3_CH4  TIM3  PWM(3) GPIO(52)
PA15 TIM2_CH1  TIM2  PWM(4) GPIO(53) 
PB14 TIM8_CH2N TIM8  PWM(5) GPIO(54)
PB15 TIM8_CH3N TIM8  PWM(6) GPIO(55)
#PA8 TIM1_CH1  TIM1  PWM(7) GPIO(56)

# filesystem setup on sdcard
define HAL_OS_FATFS_IO 1
define STM32_PWM_USE_ADVANCED TRUE

# reduce max size of embedded params for apj_tool.py
define AP_PARAM_MAX_EMBEDDED_PARAM 1024

# board voltage
STM32_VDD 330U

# GPS drivers
define AP_GPS_BACKEND_DEFAULT_ENABLED 0
define AP_GPS_UBLOX_ENABLED 1
define AP_GPS_DRONECAN_ENABLED HAL_ENABLE_DRONECAN_DRIVERS

define HAL_HIGH_LATENCY2_ENABLED 1
define HAL_GYROFFT_ENABLED 1
define GPS_MOVING_BASELINE 1
define HAL_BARO_WIND_COMP_ENABLED 1
define AP_MISSION_NAV_PAYLOAD_PLACE_ENABLED 1
define AC_PAYLOAD_PLACE_ENABLED 1
define AP_OPTICALFLOW_ENABLED 1
define AP_ADVANCEDFAILSAFE_ENABLED 1
define AP_MAVLINK_MSG_RELAY_STATUS_ENABLED 1

# battery backends:
define AP_BATTERY_BACKEND_DEFAULT_ENABLED 0
define AP_BATTERY_UAVCAN_BATTERYINFO_ENABLED HAL_ENABLE_DRONECAN_DRIVERS
define AP_BATTERY_SMBUS_ENABLED 1
define AP_BATTERY_SMBUS_GENERIC_ENABLED AP_BATTERY_SMBUS_ENABLED

# airspeed sensors
define AP_AIRSPEED_BACKEND_DEFAULT_ENABLED 0
define AP_AIRSPEED_DRONECAN_ENABLED HAL_ENABLE_DRONECAN_DRIVERS

# disabled 
define AP_RC_CHANNEL_AUX_FUNCTION_STRINGS_ENABLED 0
define AP_GRIPPER_ENABLED 0
define HAL_SPRAYER_ENABLED 0
define AP_NOTIFY_NCP5623_ENABLED 0
define HAL_HOTT_TELEM_ENABLED 0
define AP_LTM_TELEM_ENABLED 0
define NUM_SERVO_CHANNELS 16
define AP_WINCH_ENABLED 0
define AP_CAN_SLCAN_ENABLED 0
define HAL_PICCOLO_CAN_ENABLE 0
define AP_BEACON_ENABLED 0
define AP_BARO_PROBE_EXTERNAL_I2C_BUSES 0
define HAL_MOUNT_ENABLED 0
define HAL_NMEA_OUTPUT_ENABLED 0
define HAL_DISPLAY_ENABLED 0
define AP_INERTIALSENSOR_KILL_IMU_ENABLED 0
define AP_SCHEDULER_EXTENDED_TASKINFO_ENABLED 0
define AP_LANDINGGEAR_ENABLED APM_BUILD_COPTER_OR_HELI
define OFFBOARD_GUIDED 0
define QAUTOTUNE_ENABLED 0
define AP_SBUSOUTPUT_ENABLED 0
define AP_ICENGINE_ENABLED 0
define AC_PRECLAND_ENABLED 0
define AP_BOOTLOADER_FLASHING_ENABLED 0
define HAL_GENERATOR_ENABLED 0

# remove various OSD features by default:
define OSD_ENABLED 0
define HAL_PLUSCODE_ENABLE 0
define HAL_OSD_SIDEBAR_ENABLE 0
define OSD_PARAM_ENABLED 0
define HAL_CRSF_TELEM_ENABLED 0
define HAL_SOARING_ENABLED 0
define HAL_RUNCAM_ENABLED 0
define AP_SMARTAUDIO_ENABLED 0
define HAL_SPEKTRUM_TELEM_ENABLED 0
define HAL_MSP_ENABLED 0

# Copter-specific defines; these defines are only used in the Copter
#  directory, but are seen across the entire codebase:
define MODE_FLOWHOLD_ENABLED 0
define MODE_ZIGZAG_ENABLED 0
define AC_NAV_GUIDED 0
define AC_OAPATHPLANNER_ENABLED 0
define MODE_FOLLOW_ENABLED 0
define MODE_GUIDED_NOGPS_ENABLED 0
define MODE_SYSTEMID_ENABLED 0
define WEATHERVANE_ENABLED 0
define MODE_AUTOROTATE_ENABLED 0

# Camera backends for only mapping
define AP_CAMERA_BACKEND_DEFAULT_ENABLED 0
define AP_CAMERA_RELAY_ENABLED AP_CAMERA_ENABLED
define AP_CAMERA_SERVO_ENABLED AP_CAMERA_ENABLED

define AP_MOTORS_FRAME_DEFAULT_ENABLED 0
define AP_MOTORS_FRAME_QUAD_ENABLED 1
define AP_MOTORS_FRAME_HEXA_ENABLED 1
define AP_MOTORS_FRAME_OCTA_ENABLED 1
