include ../VM-L431/hwdef.inc

define CAN_APP_NODE_NAME "com.vimdrones.bms"

# board ID for firmware load
APJ_BOARD_ID AP_HW_VIMDRONES_BMS

# battery specific definitions
# define AP_BATTMON_CELL_COUNT 6

# Serial ports
SERIAL_ORDER EMPTY EMPTY USART2

PA2 USART2_TX USART2
PA3 USART2_RX USART2

STDOUT_BAUDRATE 57600
STDOUT_SERIAL SD2

# enable battery monitor
define AP_PERIPH_BATTERY_ENABLED 1
define AP_BATTERY_TIBQ76952_ENABLED 1
define AP_BATTERY_TIBQ76952_I2C_DEVICE "tibq76952"
define HAL_BATT_MONITOR_DEFAULT 32
define AP_PERIPH_BATTERY_MODEL_NAME "VM-L431-BMS"

# I2C1 for TI BMS chip
PB6 I2C1_SCL I2C1
PB7 I2C1_SDA I2C1
I2C_ORDER I2C1

# LEDs
PA4 LED1 OUTPUT OPENDRAIN GPIO(1) HIGH
PA5 LED2 OUTPUT OPENDRAIN GPIO(2) HIGH
PA6 LED3 OUTPUT OPENDRAIN GPIO(3) HIGH
PA7 LED4 OUTPUT OPENDRAIN GPIO(4) HIGH
PB0 LED5 OUTPUT OPENDRAIN GPIO(5) HIGH
PB1 LED6 OUTPUT OPENDRAIN GPIO(6) HIGH
PA8 LED7 OUTPUT OPENDRAIN GPIO(7) HIGH
PA9 LED8 OUTPUT OPENDRAIN GPIO(8) HIGH
define AP_PERIPH_BMS_LED_PINS 1,2,3,4,5,6,7,8

# Buttons
PB4 BTN1 INPUT PULLUP GPIO(9) 
define HAL_GPIO_PIN_BMS_BTN1 9 

define HAL_USE_ADC FALSE
define STM32_ADC_USE_ADC1 FALSE
define HAL_DISABLE_ADC_DRIVER TRUE

define AP_PERIPH_BATTERY_BMS_ENABLED 1
define AP_PERIPH_RTC_ENABLED 1
define AP_PERIPH_RTC_GLOBALTIME_ENABLED 1
