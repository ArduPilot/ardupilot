# hw definition file for UAV-DEV GmbH MAX10S GNSS

# MCU class and specific type
MCU STM32L431 STM32L431xx

# bootloader starts firmware at 36k + 4k (STORAGE_FLASH)
FLASH_RESERVE_START_KB 40
FLASH_SIZE_KB 256

# store parameters in pages 18 and 19
STORAGE_FLASH_PAGE 18
define HAL_STORAGE_SIZE 800

# board ID
APJ_BOARD_ID AP_HW_UAV-DEV-M10S-L4

define CAN_APP_NODE_NAME "com.uav-dev.m10s"

# crystal frequency
OSCILLATOR_HZ 24000000

# AP_PERIPH firmware
env AP_PERIPH 1

define SERIAL_BUFFERS_SIZE 512
define PORT_INT_REQUIRED_STACK 64

define DMA_RESERVE_SIZE 0

# MAIN_STACK is stack for ISR handlers
MAIN_STACK 0x300

# PROCESS_STACK controls stack for main thread
PROCESS_STACK 0xA00

# we setup a small defaults.parm
define AP_PARAM_MAX_EMBEDDED_PARAM 512

# LEDs
PC13 LED           OUTPUT OPENDRAIN HIGH
PC14 LED_ACTIVITY  OUTPUT OPENDRAIN HIGH
PC15 LED_ACTIVITY2 OUTPUT OPENDRAIN HIGH
define HAL_LED_ON 0

# debugger support
PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD

# I2C
I2C_ORDER I2C1
PB6 I2C1_SCL I2C1
PB7 I2C1_SDA I2C1
define HAL_I2C_CLEAR_ON_TIMEOUT 0
define HAL_I2C_INTERNAL_MASK 1

# CAN
CAN_ORDER 1
PA11 CAN1_RX CAN1
PA12 CAN1_TX CAN1
PA15 GPIO_CAN1_SILENT OUTPUT PUSHPULL SPEED_LOW LOW

# UARTs
SERIAL_ORDER USART3

# USART3 for GPS
PB10 USART3_TX USART3 SPEED_HIGH 
PB11 USART3_RX USART3 SPEED_HIGH 

# keep ROMFS uncompressed as we don't have enough RAM
# to uncompress the bootloader at runtime
env ROMFS_UNCOMPRESSED True

# GNSS
define AP_PERIPH_GPS_ENABLED 1
define GPS_MAX_RATE_MS 200
define GPS_MAX_RECEIVERS 1
define GPS_MAX_INSTANCES 1
define HAL_PERIPH_GPS_PORT_DEFAULT 0

# enable compass
define AP_PERIPH_MAG_ENABLED 1
define HAL_COMPASS_MAX_SENSORS 1
COMPASS BMM150 I2C:0:0x10 false ROTATION_ROLL_180

# disable unnecessary threads
define HAL_NO_RCOUT_THREAD
define HAL_NO_TIMER_THREAD
define HAL_USE_ADC FALSE
