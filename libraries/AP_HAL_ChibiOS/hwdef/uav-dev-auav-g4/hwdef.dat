# hw definition file for AUAV airspeed sensor from UAV-DEV GmbH

# MCU class and specific type
MCU STM32G4xx STM32G474xx

# board ID for firmware load
APJ_BOARD_ID AP_HW_UAV-DEV-AUAV-G4

# define node name
define CAN_APP_NODE_NAME "com.uav-dev.auav"

# setup build for a peripheral firmware
env AP_PERIPH 1

# crystal frequency
OSCILLATOR_HZ 24000000

# define flash memory
FLASH_SIZE_KB 512
FLASH_RESERVE_START_KB 36
STORAGE_FLASH_PAGE 16
define HAL_STORAGE_SIZE 800
define AP_PARAM_MAX_EMBEDDED_PARAM 256

# use DMA
DMA_NOSHARE *

# LEDs
PC13 LED   OUTPUT OPENDRAIN HIGH GPIO(0)

# order of UARTs
SERIAL_ORDER USART3

# USART3, debug
PB10 USART3_TX USART3 NODMA
PB11 USART3_RX USART3 NODMA
STDOUT_SERIAL SD3
STDOUT_BAUDRATE 57600

# CAN bus
CANFD_SUPPORTED 8

PA11 CAN1_RX CAN1
PA12 CAN1_TX CAN1
PA8 GPIO_CAN1_SILENT OUTPUT PUSHPULL SPEED_LOW LOW

PB12 CAN2_RX CAN2
PB13 CAN2_TX CAN2
PB15 GPIO_CAN2_SILENT OUTPUT PUSHPULL SPEED_LOW LOW

# I2C bus
I2C_ORDER I2C1
define HAL_I2C_INTERNAL_MASK 1
PB7  I2C1_SDA I2C1
PA15 I2C1_SCL I2C1

# SWD debugging
PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD

define AP_PERIPH_AIRSPEED_ENABLED 1
define AIRSPEED_MAX_SENSORS 1
define HAL_AIRSPEED_TYPE_DEFAULT 18

define AP_PERIPH_BARO_ENABLED 1
define AP_BARO_BACKEND_DEFAULT_ENABLED 0
define AP_BARO_AUAV_ENABLED 1
define BARO_MAX_INSTANCES 1
BARO AUAV I2C:0:0x27

# keep ROMFS uncompressed as we don't have enough RAM
# to uncompress the bootloader at runtime
env ROMFS_UNCOMPRESSED True

# disable unused features
define HAL_NO_RCOUT_THREAD
define HAL_USE_ADC FALSE
