# hw definition file for processing by chibios_hwdef.py
# for H757 bootloader

# MCU class and specific type
MCU STM32H7xx STM32H757xx

define CORE_CM7
define SMPS_PWR

# USB setup
USB_VENDOR 0x2DAE # ONLY FOR USE BY HEX! NOBODY ELSE
USB_PRODUCT 0x5011
USB_STRING_MANUFACTURER "CubePilot"

# setup build for a peripheral firmware
env AP_PERIPH 1

# crystal frequency
OSCILLATOR_HZ 24000000

# board ID for firmware load
APJ_BOARD_ID 1037

FLASH_SIZE_KB 2048

# bootloader is installed at zero offset
FLASH_RESERVE_START_KB 0

# the location where the bootloader will put the firmware
# the H743 has 128k sectors
FLASH_BOOTLOADER_LOAD_KB 256

FULL_CHIBIOS_BOOTLOADER TRUE

define HAL_LED_ON 1

#PA4 LED_ENABLE OUTPUT HIGH

PD8 USART3_TX USART3
PD9 USART3_RX USART3

# board voltage
STM32_VDD 180U

# order of UARTs (and USB)
SERIAL_ORDER OTG1

define HAL_NO_LOGGING TRUE
define HAL_NO_MONITOR_THREAD

PC1 USB_RST OUTPUT PUSHPULL SPEED_LOW HIGH
PA7 USB_OSC_EN INPUT FLOATING
PB14 USB_CS OUTPUT PUSHPULL SPEED_LOW LOW

PA5     OTG_HS_ULPI_CK  OTG_HS SPEED_HIGH
PC2     OTG_HS_ULPI_DIR OTG_HS SPEED_HIGH
PC0     OTG_HS_ULPI_STP OTG_HS SPEED_HIGH
PC3     OTG_HS_ULPI_NXT OTG_HS SPEED_HIGH
PA3     OTG_HS_ULPI_D0  OTG_HS SPEED_HIGH
PB0     OTG_HS_ULPI_D1  OTG_HS SPEED_HIGH
PB1     OTG_HS_ULPI_D2  OTG_HS SPEED_HIGH
PB10    OTG_HS_ULPI_D3  OTG_HS SPEED_HIGH
PB11    OTG_HS_ULPI_D4  OTG_HS SPEED_HIGH
PB12    OTG_HS_ULPI_D5  OTG_HS SPEED_HIGH
PB13    OTG_HS_ULPI_D6  OTG_HS SPEED_HIGH
PB5     OTG_HS_ULPI_D7  OTG_HS SPEED_HIGH

define STM32_USB_USE_OTG1 FALSE
define STM32_USE_USB_OTG2_HS FALSE
define USB_USE_WAIT TRUE

PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD

# enable CAN support
PA11 CAN1_RX CAN1
PA12 CAN1_TX CAN1
PC13 SLEEP_CAN1 OUTPUT LOW

#PB5 CAN2_RX CAN2
#PB6 CAN2_TX CAN2
PE12 SLEEP_CAN2 OUTPUT PUSHPULL SPEED_LOW HIGH
PB7  SWITCH_CAN2_USB OUTPUT PUSHPULL SPEED_LOW LOW

define CAN_APP_NODE_NAME "com.cubepilot.herepro"
